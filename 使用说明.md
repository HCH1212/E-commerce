# E-commerce 项目一键启动/关闭脚本

## 🚀 快速开始

```bash
# 启动所有服务
start_all.bat

# 关闭所有服务
stop_all.bat
```

## 📋 脚本说明

### 脚本文件

- **start_all.bat** - 一键启动所有服务
- **stop_all.bat** - 一键关闭所有服务  
- **start.bat** - 启动 Docker 基础服务（被 start_all.bat 调用）

---

## 🚀 启动脚本 (start_all.bat)

### 功能说明

`start_all.bat` 会按照以下顺序自动启动所有服务：

1. **Docker 基础服务** - MySQL, Redis, Consul, NATS
2. **Frontend 服务** - 前端网关服务（优先启动）
3. **Product 服务** - 商品服务（第二优先）
4. **初始化商品数据** - 自动导入默认商品数据
5. **其他微服务** - User, Cart, Order, Payment, Checkout, Email, Casbin, Eino

### 使用方法

```bash
# 双击运行或在命令行中执行
start_all.bat
```

### 启动详情

- 每个微服务会在独立的命令行窗口中运行
- 每个窗口标题显示对应的服务名称
- 服务之间有适当的延迟，确保依赖服务先启动
- 脚本会自动调用现有的 `start.bat` 来启动 Docker 基础服务

### 访问地址

启动完成后，您可以访问：

- **前端页面**: http://localhost:8080
- **Consul**: http://localhost:8500
- **MySQL**: localhost:3306 (用户名: root, 密码: 041212)

---

## 🛑 关闭脚本 (stop_all.bat)

### 功能说明

`stop_all.bat` 会按照优雅关闭顺序自动关闭所有运行中的服务：

1. **关闭其他微服务** - User, Product, Cart, Order, Payment, Checkout, Email, Casbin, Eino
2. **最后关闭 Frontend 服务** - 确保前端网关最后停止
3. **关闭 Docker 容器** - 停止所有 Docker 基础服务

### 使用方法

```bash
# 双击运行或在命令行中执行
stop_all.bat
```

### 关闭详情

- 通过窗口标题关闭各个服务窗口
- Frontend 服务最后关闭，保证优雅停机
- 使用 `taskkill` 强制终止残留进程
- 执行 `docker compose down` 停止所有 Docker 容器
- 自动清理所有服务窗口和进程

---

## 📝 注意事项

### 启动前准备

1. **确保 Docker Desktop 已启动**
2. **确保已安装 Go 环境**
3. **确保项目依赖已下载** (`go mod download`)
4. **确保端口未被占用** (特别是 8080, 3306, 6379, 8500 等)

### 常见问题

#### 1. 服务启动失败

- 检查对应服务窗口的错误信息
- 确认 Docker 服务是否正常运行
- 检查端口是否被占用

#### 2. 商品数据初始化失败

- 等待 MySQL 完全启动后（约 10-15 秒）
- 手动执行: `make init_product_data`

#### 3. 无法关闭某些服务

- 手动在任务管理器中结束相关进程
- 使用 `docker compose down -v` 清理 Docker 资源

### 手动操作替代方案

如果脚本无法正常工作，您也可以手动启动服务：

```bash
# 启动 Docker 基础服务
start.bat

# 启动各个微服务（在不同终端窗口）
make frontend_run
make product_run
make init_product_data
make user_run
make cart_run
make order_run
make payment_run
make checkout_run
make email_run
make casbin_run
make eino_run
```

---

## 🔧 技术细节

### 启动顺序说明

按照您的要求，启动顺序为：

1. `start.bat` - 启动 Docker 基础设施
2. `frontend` - 前端服务优先启动
3. `product` - 商品服务第二优先
4. `init_product_data` - 初始化商品数据
5. 其他服务 - 并行启动其余微服务

### 服务依赖关系

- Frontend 依赖所有后端微服务
- Product 服务需要先启动才能初始化数据
- 其他微服务之间相对独立，可以并行启动

---

## 📞 支持

如有问题，请查看：

1. 各服务窗口的日志输出
2. `本地运行指南.md` 文件
3. 项目 README.md 文件

---

**祝您使用愉快！** 🎉
