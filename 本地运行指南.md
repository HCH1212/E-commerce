# E-commerce é¡¹ç›®æœ¬åœ°è¿è¡ŒæŒ‡å—

## ğŸ“‹ å‰ç½®è¦æ±‚

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„ç³»ç»Ÿå·²å®‰è£…ä»¥ä¸‹å·¥å…·ï¼š

- âœ… **Docker Desktop** - ç”¨äºè¿è¡ŒåŸºç¡€è®¾æ–½æœåŠ¡
- âœ… **Go 1.17-1.23** - Go å¼€å‘ç¯å¢ƒ
- âœ… **Make** - æ„å»ºå·¥å…·
- âœ… **Git** - ç‰ˆæœ¬æ§åˆ¶

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆæ¨èï¼‰

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ä¸€é”®å¯åŠ¨è„šæœ¬

1. **è¿è¡Œå¯åŠ¨è„šæœ¬**
   ```bash
   start.bat
   ```
   
   è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
   - âœ“ å¯åŠ¨ Docker åŸºç¡€æœåŠ¡ï¼ˆMySQL, Redis, Consul, NATSï¼‰
   - âœ“ ç­‰å¾… MySQL æœåŠ¡å°±ç»ª
   - âœ“ è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰éœ€è¦çš„æ•°æ®åº“

2. **å¯åŠ¨å¾®æœåŠ¡**
   
   è„šæœ¬å®Œæˆåï¼ŒæŒ‰ç…§æç¤ºåœ¨ **10 ä¸ªä¸åŒçš„ç»ˆç«¯çª—å£** ä¸­åˆ†åˆ«è¿è¡Œï¼š
   ```bash
   make user_run      # ç»ˆç«¯ 1: ç”¨æˆ·æœåŠ¡
   make product_run   # ç»ˆç«¯ 2: å•†å“æœåŠ¡
   make cart_run      # ç»ˆç«¯ 3: è´­ç‰©è½¦æœåŠ¡
   make order_run     # ç»ˆç«¯ 4: è®¢å•æœåŠ¡
   make payment_run   # ç»ˆç«¯ 5: æ”¯ä»˜æœåŠ¡
   make checkout_run  # ç»ˆç«¯ 6: ç»“è´¦æœåŠ¡
   make email_run     # ç»ˆç«¯ 7: é‚®ä»¶æœåŠ¡
   make casbin_run    # ç»ˆç«¯ 8: æƒé™æ§åˆ¶æœåŠ¡
   make eino_run      # ç»ˆç«¯ 9: AI æœåŠ¡
   make frontend_run  # ç»ˆç«¯ 10: å‰ç«¯æœåŠ¡
   ```

3. **è®¿é—®åº”ç”¨**
   ```bash
   http://localhost:8080
   ```

---

## ğŸ“ è¯¦ç»†æ­¥éª¤ï¼ˆæ‰‹åŠ¨å¯åŠ¨ï¼‰

### æ­¥éª¤ 1: é…ç½®æ£€æŸ¥

ç¡®ä¿ `common/mtl/tracing.go` ä½¿ç”¨æœ¬åœ°é…ç½®ï¼š

```go
provider.WithExportEndpoint("127.0.0.1:4317"), // æœ¬åœ°ç”¨è¿™è¡Œ
```

### æ­¥éª¤ 2: å¯åŠ¨ Docker åŸºç¡€æœåŠ¡

```bash
make docker
```

è¿™ä¼šå¯åŠ¨ä»¥ä¸‹å®¹å™¨ï¼š
- **MySQL** (ç«¯å£ 3306) - æ•°æ®åº“
- **Redis** (ç«¯å£ 6379) - Session å­˜å‚¨
- **Consul** (ç«¯å£ 8500) - æœåŠ¡æ³¨å†Œä¸å‘ç°
- **NATS** (ç«¯å£ 4222, 8222) - æ¶ˆæ¯ä¸­é—´ä»¶

éªŒè¯å®¹å™¨è¿è¡ŒçŠ¶æ€ï¼š
```bash
docker ps
```

### æ­¥éª¤ 3: åˆå§‹åŒ–æ•°æ®åº“

```bash
make init_db
```

æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œï¼š
```bash
docker exec -i e-commerce-mysql-1 mysql -uroot -p041212 < init_databases.sql
```

è¿™ä¼šåˆ›å»ºä»¥ä¸‹æ•°æ®åº“ï¼š
- `user` - ç”¨æˆ·æ•°æ®
- `product` - å•†å“æ•°æ®
- `cart` - è´­ç‰©è½¦æ•°æ®
- `order` - è®¢å•æ•°æ®
- `payment` - æ”¯ä»˜æ•°æ®

**æ³¨æ„ï¼š** æ•°æ®åº“è¡¨ä¼šåœ¨å„ä¸ªæœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºï¼ˆGORM AutoMigrateï¼‰

### æ­¥éª¤ 4: å¯åŠ¨å¾®æœåŠ¡

**é‡è¦æç¤ºï¼š** è¯·æŒ‰ç…§é¡ºåºå¯åŠ¨ï¼Œæ¯ä¸ªæœåŠ¡åœ¨å•ç‹¬çš„ç»ˆç«¯çª—å£ä¸­è¿è¡Œã€‚

```bash
# ç»ˆç«¯ 1
make user_run

# ç»ˆç«¯ 2
make product_run

# ç»ˆç«¯ 3
make cart_run

# ç»ˆç«¯ 4
make order_run

# ç»ˆç«¯ 5
make payment_run

# ç»ˆç«¯ 6
make checkout_run

# ç»ˆç«¯ 7
make email_run

# ç»ˆç«¯ 8
make casbin_run

# ç»ˆç«¯ 9
make eino_run

# ç»ˆç«¯ 10
make frontend_run
```

### æ­¥éª¤ 5: åˆå§‹åŒ–å•†å“æ•°æ®ï¼ˆå¯é€‰ï¼‰

ç­‰å¾… **product æœåŠ¡å¯åŠ¨å®Œæˆ** åï¼ˆå®ƒä¼šè‡ªåŠ¨åˆ›å»º products è¡¨ï¼‰ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤åˆå§‹åŒ–é»˜è®¤å•†å“æ•°æ®ï¼š

```bash
make init_product_data
```

æˆ–è€…æ‰‹åŠ¨æ‰§è¡Œï¼š
```bash
docker exec -i e-commerce-mysql-1 mysql -uroot -p041212 < app/product/default.sql
```

è¿™ä¼šæ’å…¥ 9 ä¸ªé»˜è®¤å•†å“ï¼ŒåŒ…å«å•†å“åç§°ã€æè¿°ã€å›¾ç‰‡ã€ä»·æ ¼å’Œåˆ†ç±»ä¿¡æ¯ã€‚

**é‡è¦æç¤ºï¼š** 
- å¿…é¡»åœ¨ `make product_run` å¯åŠ¨åæ‰èƒ½æ‰§è¡Œæ­¤å‘½ä»¤
- å¦‚æœæ•°æ®åº“æ˜¯å…¨æ–°çš„ï¼Œå»ºè®®æ‰§è¡Œè¿™ä¸€æ­¥ä»¥ä¾¿æµ‹è¯•è´­ç‰©åŠŸèƒ½
- è¿™ä¸€æ­¥æ˜¯å¯é€‰çš„ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å‰ç«¯ç•Œé¢æ‰‹åŠ¨æ·»åŠ å•†å“

### æ­¥éª¤ 6: è®¿é—®åº”ç”¨

- **å‰ç«¯é¡µé¢**: http://localhost:8080
- **Consul UI**: http://localhost:8500
- **MySQL**: localhost:3306 (ç”¨æˆ·å: root, å¯†ç : 041212)

---

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### Make å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `make docker` | å¯åŠ¨ Docker åŸºç¡€æœåŠ¡ |
| `make init_db` | åˆå§‹åŒ–æ•°æ®åº“ |
| `make init_product_data` | åˆå§‹åŒ–å•†å“æ•°æ®ï¼ˆéœ€å…ˆå¯åŠ¨ product æœåŠ¡ï¼‰|
| `make user_run` | å¯åŠ¨ç”¨æˆ·æœåŠ¡ |
| `make product_run` | å¯åŠ¨å•†å“æœåŠ¡ |
| `make cart_run` | å¯åŠ¨è´­ç‰©è½¦æœåŠ¡ |
| `make order_run` | å¯åŠ¨è®¢å•æœåŠ¡ |
| `make payment_run` | å¯åŠ¨æ”¯ä»˜æœåŠ¡ |
| `make checkout_run` | å¯åŠ¨ç»“è´¦æœåŠ¡ |
| `make email_run` | å¯åŠ¨é‚®ä»¶æœåŠ¡ |
| `make casbin_run` | å¯åŠ¨æƒé™æ§åˆ¶æœåŠ¡ |
| `make eino_run` | å¯åŠ¨ AI æœåŠ¡ |
| `make frontend_run` | å¯åŠ¨å‰ç«¯æœåŠ¡ |
| `make web` | åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å‰ç«¯é¡µé¢ |
| `make consul` | åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Consul UI |

### Docker å‘½ä»¤

```bash
# æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨
docker ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs e-commerce-mysql-1
docker logs e-commerce-redis-1
docker logs e-commerce-consul-1
docker logs e-commerce-nats-1

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker compose down

# é‡å¯ Docker æœåŠ¡
docker compose restart
```

### æ•°æ®åº“è¿æ¥

```bash
# è¿æ¥åˆ° MySQL
docker exec -it e-commerce-mysql-1 mysql -uroot -p041212

# æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“
SHOW DATABASES;

# ä½¿ç”¨ç‰¹å®šæ•°æ®åº“
USE user;
SHOW TABLES;
```

---

## â“ å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥é”™è¯¯: "Unknown database 'xxx'"

**è§£å†³æ–¹æ¡ˆï¼š** è¿è¡Œæ•°æ®åº“åˆå§‹åŒ–å‘½ä»¤
```bash
make init_db
```

### 2. ç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆï¼š** æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µï¼Œå…³é—­å†²çªçš„æœåŠ¡
```bash
# Windows
netstat -ano | findstr "3306"
netstat -ano | findstr "6379"
netstat -ano | findstr "8500"
```

### 3. Docker å®¹å™¨å¯åŠ¨å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿ Docker Desktop æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥ Docker èµ„æºé…ç½®ï¼ˆå†…å­˜è‡³å°‘ 4GBï¼‰
3. é‡å¯ Docker Desktop

### 4. Go ç‰ˆæœ¬è­¦å‘Š

å¦‚æœçœ‹åˆ° sonic ç‰ˆæœ¬è­¦å‘Šï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œä¸å½±å“è¿è¡Œã€‚é¡¹ç›®æ”¯æŒ Go 1.17-1.23ã€‚

### 5. æŸä¸ªæœåŠ¡å¯åŠ¨å¤±è´¥

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ Consul æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. æ£€æŸ¥ä¾èµ–çš„æœåŠ¡æ˜¯å¦å·²å¯åŠ¨
3. æŸ¥çœ‹æœåŠ¡æ—¥å¿—å®šä½å…·ä½“é”™è¯¯

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### å¾®æœåŠ¡åˆ—è¡¨

| æœåŠ¡å | ç«¯å£ | è¯´æ˜ |
|--------|------|------|
| user | 8888 | ç”¨æˆ·ç®¡ç†æœåŠ¡ |
| product | - | å•†å“ç®¡ç†æœåŠ¡ |
| cart | - | è´­ç‰©è½¦æœåŠ¡ |
| order | - | è®¢å•æœåŠ¡ |
| payment | - | æ”¯ä»˜æœåŠ¡ |
| checkout | - | ç»“è´¦æœåŠ¡ |
| email | - | é‚®ä»¶æœåŠ¡ |
| casbin | - | æƒé™æ§åˆ¶æœåŠ¡ (RBAC) |
| eino | - | AI æœåŠ¡ |
| frontend | 8080 | å‰ç«¯ HTTP æœåŠ¡ |

### æŠ€æœ¯æ ˆ

- **RPC æ¡†æ¶**: Kitex
- **HTTP æ¡†æ¶**: Hertz
- **æ•°æ®åº“**: MySQL 8.0
- **ç¼“å­˜**: Redis 7.0
- **æœåŠ¡å‘ç°**: Consul
- **æ¶ˆæ¯é˜Ÿåˆ—**: NATS
- **æƒé™æ§åˆ¶**: Casbin (RBAC)
- **é“¾è·¯è¿½è¸ª**: OpenTelemetry
- **å‰ç«¯æ¡†æ¶**: Bootstrap

---

## ğŸ“š æ›´å¤šèµ„æº

- **é¡¹ç›®æ–‡æ¡£**: https://redrock.feishu.cn/docx/MkIOdIvpuorOCTxoYA4cvI0knge
- **GitHub**: https://github.com/MyGoFor/E-commerce

---

## ğŸ”„ åœæ­¢æœåŠ¡

### åœæ­¢æ‰€æœ‰å¾®æœåŠ¡
åœ¨å„ä¸ªç»ˆç«¯çª—å£ä¸­æŒ‰ `Ctrl + C`

### åœæ­¢ Docker æœåŠ¡
```bash
docker compose down
```

### å®Œå…¨æ¸…ç†ï¼ˆåŒ…æ‹¬æ•°æ®ï¼‰
```bash
docker compose down -v
```

---

**æç¤º**: å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œè¯·æŸ¥çœ‹å„ä¸ªæœåŠ¡çš„æ—¥å¿—æ–‡ä»¶æˆ–åœ¨ GitHub ä¸Šæäº¤ Issueã€‚
